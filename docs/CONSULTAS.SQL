
--Requerimiento 1: MOSTRAR EL DINERO RECOLECTADO POR SERVICIOS EN CADA HABITACIÓN EN EL ÚLTIMO AÑO CORRIDO

SELECT  /*+ USE_HASH(R, C, S) */
    H.ID AS Habitacion_ID, 
    S.DESCRIPCION, 
    SUM(S.PRECIO) AS Total_Precio  
FROM   
    HABITACION H  
    INNER JOIN RESERVAS R ON R.HABITACIONID = H.ID  
    INNER JOIN CONSUMODER C ON C.RESERVASID = R.ID  
    INNER JOIN SERVICIO S ON S.CONSUMOID = C.CONSUMOID 
WHERE   
    R.FECHAENTRADA >= TRUNC(SYSDATE) - INTERVAL '1' YEAR    
GROUP BY   
    H.ID, S.DESCRIPCION 
ORDER BY H.ID;

-- req 5
SELECT 
    R.USUARIOSID AS USUARIO_ID, 
    S.DESCRIPCION AS TIPO_CONSUMO, 
    S.PRECIO AS COSTO  
FROM 
    CONSUMOS C 
    INNER JOIN SERVICIO S ON S.CONSUMOID = C.ID 
    INNER JOIN CONSUMODER CR ON CR.CONSUMOID = C.ID 
    INNER JOIN RESERVAS R ON CR.RESERVASID = R.ID 
WHERE 
    R.USUARIOSID = 12555 
    AND C.FECHA BETWEEN TO_DATE('1990-01-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS') 
                    AND TO_DATE('2023-06-30 00:00:00', 'YYYY-MM-DD HH24:MI:SS');

SELECT index_name, table_name
FROM user_indexes;

--9) CONSULTAR CONSUMO EN HOTELANDES
CREATE INDEX nombre_servicio ON SERVICIO(DESCRIPCION);


-- OP1 ORDENAR POR DATOS DEL CLIENTE (NOMBRE): 

SELECT  /*+ USE_HASH(R, C, S) */
DISTINCT U.ID, U.NOMBRE, S.DESCRIPCION AS TIPO
FROM SERVICIO S
JOIN CONSUMOS C ON C.ID= S.CONSUMOID
JOIN CONSUMODER CR ON CR.CONSUMOID=C.ID
JOIN RESERVAS R ON R.ID=CR.RESERVASID
JOIN USUARIOS U ON U.ID= R.USUARIOSID
WHERE S.DESCRIPCION='Internet' AND C.FECHA BETWEEN '1/1/15' AND '31/12/20'
ORDER BY U.NOMBRE;

-- OP2 ORDENAR POR DATOS DEL CLIENTE (ID): 
SELECT /*+ USE_HASH(R, C, S) */
DISTINCT U.ID, U.NOMBRE, S.DESCRIPCION
FROM SERVICIO S
JOIN CONSUMOS C ON C.ID= S.CONSUMOID
JOIN CONSUMODER CR ON CR.CONSUMOID=C.ID
JOIN RESERVAS R ON R.ID=CR.RESERVASID
JOIN USUARIOS U ON U.ID= R.USUARIOSID
WHERE S.DESCRIPCION='SPA' AND C.FECHA BETWEEN '1/1/80' AND '31/12/10'
ORDER BY U.ID;

-- OP3 AGRUPAR POR FECHA Y NUMERO DE VECES UTILIZADO : 
SELECT /*+ USE_HASH(R, C, S) */
C.FECHA, S.DESCRIPCION AS SERVICIO, COUNT(*) AS NUMERO_VECES_UTILIZADO
FROM SERVICIO S
JOIN CONSUMOS C ON C.ID = S.CONSUMOID
JOIN CONSUMODER CR ON CR.CONSUMOID = C.ID
JOIN RESERVAS R ON R.ID = CR.RESERVASID
JOIN USUARIOS U ON U.ID = R.USUARIOSID
WHERE S.DESCRIPCION = 'SPA' AND C.FECHA BETWEEN '1/1/80' AND '31/12/10'
GROUP BY C.FECHA, S.DESCRIPCION;



--RFC10 - 
--/*+ USE_HASH(R, C, S) */

-- OP1 ORDENAR POR DATOS DEL CLIENTE (NOMBRE): 
SELECT /*+ USE_HASH(R, C, S) */
DISTINCT U.ID, U.NOMBRE, S.DESCRIPCION
FROM SERVICIO S
JOIN CONSUMOS C ON C.ID= S.CONSUMOID
JOIN CONSUMODER CR ON CR.CONSUMOID=C.ID
JOIN RESERVAS R ON R.ID=CR.RESERVASID
JOIN USUARIOS U ON U.ID= R.USUARIOSID
WHERE S.DESCRIPCION !='SPA' AND C.FECHA BETWEEN '1/1/80' AND '31/12/10'
ORDER BY U.NOMBRE;

-- OP2 ORDENAR POR DATOS DEL CLIENTE (ID): 
SELECT /*+ USE_HASH(R, C, S) */
DISTINCT U.ID, U.NOMBRE, S.DESCRIPCION
FROM SERVICIO S
JOIN CONSUMOS C ON C.ID= S.CONSUMOID
JOIN CONSUMODER CR ON CR.CONSUMOID=C.ID
JOIN RESERVAS R ON R.ID=CR.RESERVASID
JOIN USUARIOS U ON U.ID= R.USUARIOSID
WHERE S.DESCRIPCION!='SPA' AND C.FECHA BETWEEN '1/1/80' AND '31/12/10'
ORDER BY U.ID;

-- OP3 AGRUPAR POR FECHA Y NUMERO DE VECES UTILIZADO : 
SELECT C.FECHA, S.DESCRIPCION AS SERVICIO, COUNT(*) AS NUMERO_VECES_UTILIZADO
FROM SERVICIO S
JOIN CONSUMOS C ON C.ID = S.CONSUMOID
JOIN CONSUMODER CR ON CR.CONSUMOID = C.ID
JOIN RESERVAS R ON R.ID = CR.RESERVASID
JOIN USUARIOS U ON U.ID = R.USUARIOSID
WHERE S.DESCRIPCION! = 'SPA' AND C.FECHA BETWEEN '1/1/80' AND '31/12/10'
GROUP BY C.FECHA, S.DESCRIPCION;



